#include "HelpDialog.h"
#include <QVBoxLayout>
#include <QTextBrowser>
#include <QPushButton>

HelpDialog::HelpDialog(QWidget *parent)
    : QDialog(parent)
{
    setWindowTitle(tr("Справка по сжатиям TIFF"));
    resize(700, 480);

    QVBoxLayout *layout = new QVBoxLayout(this);
    m_browser = new QTextBrowser(this);

    QString html;
    html += "<h2>Сжатия TIFF — краткое описание</h2>";

    html += "<h3>Без сжатия (None)</h3>";
    html += "<p>Данные записываются в TIFF в исходном виде без какого-либо сжатия. "
            "Это самый быстрый режим записи и полностью без потерь, но файлы получаются большими. "
            "Используется, когда важна полная точность и скорость записи.</p>";

    html += "<h3>Deflate (ZIP)</h3>";
    html += "<p>Lossless-алгоритм на основе LZ77 и дальнейшей кодировки (аналог gzip/zip). "
            "Хорошо сжимает фотографические данные и сбалансирован по скорости/степени сжатия. "
            "Доступен параметр уровня (1..9): 1 — быстро и слабо, 9 — медленнее, но сильнее сжимает.</p>";

    html += "<h3>LZMA</h3>";
    html += "<p>Современный безпотерьный алгоритм, часто даёт лучшую степень сжатия, чем Deflate, "
            "но требует больше памяти и времени при сжатии. Имеет параметр уровня (1..9), где "
            "большие значения дают более сильное сжатие.</p>";

    html += "<h3>PackBits</h3>";
    html += "<p>Простой RLE (run-length encoding) алгоритм от Apple. Очень быстрый, но эффективно "
            "работает только на изображениях с повторяющимися последовательностями байтов (например, "
            "простые маски, некоторые скриншоты). Для сложных фотографий часто даёт маленький выигрыш.</p>";

    html += "<h3>LZW</h3>";
    html += "<p>Алгоритм Lempel–Ziv–Welch — широко используемый lossless-алгоритм для TIFF. Он хорошо "
            "справляется с различными типами данных и совместим с большинством программ. Не имеет "
            "параметра в нашем интерфейсе — это «готовый» режим сжатия.</p>";

    html += "<h3>CCITT Group 3 / Group 4</h3>";
    html += "<p>Специальные алгоритмы для факсимильных данных и очень эффективны для одноцветных (1-битных) "
            "изображений. Работают только для монохромных изображений (1 бит на пиксель). Group 4 обычно "
            "даёт лучшее сжатие по сравнению с Group 3 для типичных документов.</p>";

    html += "<h3>JPEG (внутри TIFF)</h3>";
    html += "<p>Потерянное сжатие: данные предварительно кодируются как JPEG-поток и помещаются в TIFF. "
            "Подходит для цветных и полутоновых изображений, где небольшая потеря деталей допустима. "
            "Качество регулируется параметром 0..100 — больше означает лучшее качество и больший размер.</p>";

    html += "<h3>Рекомендации</h3>";
    html += "<ul>"
            "<li>Если нужен точный, безпотерьный результат — используйте None, Deflate или LZW.</li>"
            "<li>Для документов с текстом/масками — лучше CCITT (при 1-битном представлении).</li>"
            "<li>Для фотографий — Deflate или LZMA для безпотерьного хранения; JPEG если нужна меньшая "
            "весовая компрессия и приемлема потеря качества.</li>"
            "</ul>";

    m_browser->setHtml(html);
    layout->addWidget(m_browser);

    m_closeBtn = new QPushButton(tr("Закрыть"), this);
    layout->addWidget(m_closeBtn);
    connect(m_closeBtn, &QPushButton::clicked, this, &HelpDialog::accept);
}
